<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† metals_dashboard</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body {
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
        }
        .last-update {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999999);
        }
        .price-card {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .metal-name {
            font-size: 18px;
            font-weight: 600;
        }
        .price {
            font-size: 24px;
            font-weight: bold;
            direction: ltr;
        }
        .change {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 20px;
        }
        .change.positive { background: #e6f7e6; color: #00a86b; }
        .change.negative { background: #ffe6e6; color: #ff4d4d; }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 24px 0;
        }
        .menu-item {
            background: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 16px;
            border-radius: 14px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: var(--tg-theme-bg-color, #ffffff);
            border-radius: 24px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .input-group {
            margin-bottom: 16px;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--tg-theme-hint-color, #dddddd);
            border-radius: 12px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .button {
            background: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 14px 24px;
            border-radius: 14px;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            margin-bottom: 8px;
        }
        .button.danger {
            background: #ff4d4d;
        }
        .holdings-list {
            margin: 16px 0;
        }
        .holding-item {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toast-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            z-index: 1000;
            animation: fadeInOut 3s forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; bottom: 0; }
            10% { opacity: 1; bottom: 20px; }
            90% { opacity: 1; bottom: 20px; }
            100% { opacity: 0; bottom: 0; }
        }
        .warning-box {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <span class="title">ğŸ† metals_dashboard</span>
        <span class="last-update" id="lastUpdate">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...</span>
    </div>

    <!-- Ù‡Ø´Ø¯Ø§Ø± -->
    <div class="warning-box" id="warningBox">
        âš ï¸ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªØŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    </div>

    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª -->
    <div class="price-card">
        <div class="price-row">
            <span class="metal-name">ğŸ… Ø·Ù„Ø§</span>
            <span class="change" id="goldChange">+0.5%</span>
        </div>
        <div class="price-row">
            <span>Û²Û´ Ø¹ÛŒØ§Ø±</span>
            <span class="price" id="goldPrice24">Û´,ÛµÛ°Û°,Û°Û°Û°</span>
        </div>
        <div class="price-row">
            <span>Û±Û¸ Ø¹ÛŒØ§Ø±</span>
            <span class="price" id="goldPrice18">Û³,Û³Û·Ûµ,Û°Û°Û°</span>
        </div>
    </div>

    <div class="price-card">
        <div class="price-row">
            <span class="metal-name">ğŸ¥ˆ Ù†Ù‚Ø±Ù‡</span>
            <span class="change" id="silverChange">-0.2%</span>
        </div>
        <div class="price-row">
            <span>Ù‚ÛŒÙ…Øª</span>
            <span class="price" id="silverPrice">Û¶Ûµ,Û°Û°Û°</span>
        </div>
    </div>

    <!-- Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="menu-grid">
        <div class="menu-item" onclick="showPortfolio()">ğŸ’¼ Ù¾Ø±ØªÙÙˆÛŒ</div>
        <div class="menu-item" onclick="showProfit()">ğŸ’° Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†</div>
        <div class="menu-item" onclick="showAlerts()">ğŸ”” Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</div>
        <div class="menu-item" onclick="showSettings()">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù¾Ø±ØªÙÙˆÛŒ -->
    <div id="portfolioModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">ğŸ’¼ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ØªÙÙˆÛŒ</h2>
            <div class="menu-grid" style="grid-template-columns: 1fr 1fr;">
                <div class="menu-item secondary" onclick="showAddGold()">â• Ø·Ù„Ø§</div>
                <div class="menu-item secondary" onclick="showAddSilver()">â• Ù†Ù‚Ø±Ù‡</div>
            </div>
            <div id="holdingsList" class="holdings-list"></div>
            <button class="button danger" onclick="clearPortfolio()">ğŸ—‘ Ø­Ø°Ù Ù‡Ù…Ù‡</button>
            <button class="button" onclick="closeModal('portfolioModal')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ø·Ù„Ø§ -->
    <div id="addGoldModal" class="modal">
        <div class="modal-content">
            <h2>â• Ø§ÙØ²ÙˆØ¯Ù† Ø·Ù„Ø§</h2>
            <div class="input-group">
                <label>Ù…Ù‚Ø¯Ø§Ø± (Ú¯Ø±Ù…)</label>
                <input type="number" id="goldAmount" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û±Û°">
            </div>
            <div class="input-group">
                <label>Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ (ØªÙˆÙ…Ø§Ù†)</label>
                <input type="number" id="goldPrice" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û´ÛµÛ°Û°Û°Û°Û°">
            </div>
            <button class="button" onclick="addGold()">âœ… Ø«Ø¨Øª</button>
            <button class="button secondary" onclick="closeModal('addGoldModal')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù‚Ø±Ù‡ -->
    <div id="addSilverModal" class="modal">
        <div class="modal-content">
            <h2>â• Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù‚Ø±Ù‡</h2>
            <div class="input-group">
                <label>Ù…Ù‚Ø¯Ø§Ø± (Ú¯Ø±Ù…)</label>
                <input type="number" id="silverAmount" placeholder="Ù…Ø«Ù„Ø§Ù‹ ÛµÛ°Û°">
            </div>
            <div class="input-group">
                <label>Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ (ØªÙˆÙ…Ø§Ù†)</label>
                <input type="number" id="silverBuyPrice" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û¶ÛµÛ°Û°Û°">
            </div>
            <button class="button" onclick="addSilver()">âœ… Ø«Ø¨Øª</button>
            <button class="button secondary" onclick="closeModal('addSilverModal')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù† -->
    <div id="profitModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ’° Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†</h2>
            <div id="profitGold"></div>
            <div id="profitSilver"></div>
            <button class="button" onclick="closeModal('profitModal')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ -->
    <div id="alertsModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ”” Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</h2>
            <div style="margin-bottom: 20px;">
                <h3>ğŸ… Ø·Ù„Ø§</h3>
                <div class="input-group">
                    <label>Ø­Ø¯Ø§Ù‚Ù„ Ù‚ÛŒÙ…Øª</label>
                    <input type="number" id="goldMin" value="4000000">
                </div>
                <div class="input-group">
                    <label>Ø­Ø¯Ø§Ú©Ø«Ø± Ù‚ÛŒÙ…Øª</label>
                    <input type="number" id="goldMax" value="5000000">
                </div>
                <label><input type="checkbox" id="goldEnabled" checked> ÙØ¹Ø§Ù„</label>
            </div>
            <div style="margin-bottom: 20px;">
                <h3>ğŸ¥ˆ Ù†Ù‚Ø±Ù‡</h3>
                <div class="input-group">
                    <label>Ø­Ø¯Ø§Ù‚Ù„ Ù‚ÛŒÙ…Øª</label>
                    <input type="number" id="silverMin" value="60000">
                </div>
                <div class="input-group">
                    <label>Ø­Ø¯Ø§Ú©Ø«Ø± Ù‚ÛŒÙ…Øª</label>
                    <input type="number" id="silverMax" value="70000">
                </div>
                <label><input type="checkbox" id="silverEnabled" checked> ÙØ¹Ø§Ù„</label>
            </div>
            <button class="button" onclick="saveAlerts()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
            <button class="button secondary" onclick="closeModal('alertsModal')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
            <div class="input-group">
                <label>ÙØ§ØµÙ„Ù‡ Ú¯Ø²Ø§Ø±Ø´ (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                <select id="reportInterval">
                    <option value="1">Û± Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="5" selected>Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="10">Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="15">Û±Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="30">Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ú¯Ø²Ø§Ø±Ø´</label>
                <select id="reportType">
                    <option value="both" selected>Ø·Ù„Ø§ Ùˆ Ù†Ù‚Ø±Ù‡</option>
                    <option value="gold">ÙÙ‚Ø· Ø·Ù„Ø§</option>
                    <option value="silver">ÙÙ‚Ø· Ù†Ù‚Ø±Ù‡</option>
                </select>
            </div>
            <button class="button" onclick="saveSettings()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
            <button class="button secondary" onclick="closeModal('settingsModal')">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ (Mock Data)
        let mockPrices = {
            gold: 4500000,
            silver: 65000,
            goldChange: 0.5,
            silverChange: -0.2
        };

        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
        let portfolio = JSON.parse(localStorage.getItem('portfolio') || '{"holdings":[]}');
        let alerts = JSON.parse(localStorage.getItem('alerts') || '{"gold":{"enabled":true,"min":4000000,"max":5000000},"silver":{"enabled":true,"min":60000,"max":70000}}');
        let settings = JSON.parse(localStorage.getItem('settings') || '{"reportInterval":5,"reportType":"both"}');

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
        function updateDisplay() {
            document.getElementById('goldPrice24').innerText = mockPrices.gold.toLocaleString();
            document.getElementById('goldPrice18').innerText = Math.round(mockPrices.gold * 0.75).toLocaleString();
            document.getElementById('goldChange').innerText = (mockPrices.goldChange > 0 ? '+' : '') + mockPrices.goldChange + '%';
            document.getElementById('goldChange').className = `change ${mockPrices.goldChange >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('silverPrice').innerText = mockPrices.silver.toLocaleString();
            document.getElementById('silverChange').innerText = (mockPrices.silverChange > 0 ? '+' : '') + mockPrices.silverChange + '%';
            document.getElementById('silverChange').className = `change ${mockPrices.silverChange >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('lastUpdate').innerHTML = 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + new Date().toLocaleTimeString('fa-IR');
            checkAlerts();
        }

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª
        function simulatePriceChange() {
            mockPrices.gold += (Math.random() - 0.5) * 10000;
            mockPrices.silver += (Math.random() - 0.5) * 200;
            mockPrices.goldChange = ((Math.random() - 0.5) * 2).toFixed(1);
            mockPrices.silverChange = ((Math.random() - 0.5) * 2).toFixed(1);
            
            mockPrices.gold = Math.max(4000000, Math.min(5000000, Math.round(mockPrices.gold)));
            mockPrices.silver = Math.max(60000, Math.min(70000, Math.round(mockPrices.silver)));
            
            updateDisplay();
            showToast('Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯');
        }

        // Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
        function checkAlerts() {
            if (alerts.gold.enabled) {
                if (mockPrices.gold < alerts.gold.min) {
                    showToast(`âš ï¸ Ø·Ù„Ø§ Ø¨Ù‡ ${mockPrices.gold.toLocaleString()} Ø±Ø³ÛŒØ¯`);
                }
                if (mockPrices.gold > alerts.gold.max) {
                    showToast(`âš ï¸ Ø·Ù„Ø§ Ø¨Ù‡ ${mockPrices.gold.toLocaleString()} Ø±Ø³ÛŒØ¯`);
                }
            }
            
            if (alerts.silver.enabled) {
                if (mockPrices.silver < alerts.silver.min) {
                    showToast(`âš ï¸ Ù†Ù‚Ø±Ù‡ Ø¨Ù‡ ${mockPrices.silver.toLocaleString()} Ø±Ø³ÛŒØ¯`);
                }
                if (mockPrices.silver > alerts.silver.max) {
                    showToast(`âš ï¸ Ù†Ù‚Ø±Ù‡ Ø¨Ù‡ ${mockPrices.silver.toLocaleString()} Ø±Ø³ÛŒØ¯`);
                }
            }
        }

        // Ù¾Ø±ØªÙÙˆÛŒ
        function showPortfolio() {
            const list = document.getElementById('holdingsList');
            if (portfolio.holdings.length === 0) {
                list.innerHTML = '<p style="text-align:center">Ù¾Ø±ØªÙÙˆÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</p>';
            } else {
                list.innerHTML = portfolio.holdings.map(h => `
                    <div class="holding-item">
                        <div>${h.metal === 'gold' ? 'ğŸ…' : 'ğŸ¥ˆ'} ${h.amount}g @ ${h.price.toLocaleString()}</div>
                        <button onclick="removeHolding('${h.id}')" style="background:none;border:none;color:#ff4d4d;font-size:20px;">ğŸ—‘</button>
                    </div>
                `).join('');
            }
            document.getElementById('portfolioModal').style.display = 'flex';
        }

        function showAddGold() {
            closeModal('portfolioModal');
            document.getElementById('addGoldModal').style.display = 'flex';
        }

        function showAddSilver() {
            closeModal('portfolioModal');
            document.getElementById('addSilverModal').style.display = 'flex';
        }

        function addGold() {
            const amount = document.getElementById('goldAmount').value;
            const price = document.getElementById('goldPrice').value;
            if (!amount || !price) { showToast('Ù…Ù‚Ø¯Ø§Ø± Ùˆ Ù‚ÛŒÙ…Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
            
            portfolio.holdings.push({
                id: Date.now() + '-' + Math.random(),
                metal: 'gold',
                amount: parseFloat(amount),
                price: parseFloat(price)
            });
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
            closeModal('addGoldModal');
            showPortfolio();
        }

        function addSilver() {
            const amount = document.getElementById('silverAmount').value;
            const price = document.getElementById('silverBuyPrice').value;
            if (!amount || !price) { showToast('Ù…Ù‚Ø¯Ø§Ø± Ùˆ Ù‚ÛŒÙ…Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
            
            portfolio.holdings.push({
                id: Date.now() + '-' + Math.random(),
                metal: 'silver',
                amount: parseFloat(amount),
                price: parseFloat(price)
            });
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
            closeModal('addSilverModal');
            showPortfolio();
        }

        function removeHolding(id) {
            portfolio.holdings = portfolio.holdings.filter(h => h.id !== id);
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
            showPortfolio();
        }

        function clearPortfolio() {
            if (confirm('Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ø­Ø°Ù Ø´ÙˆÙ†Ø¯ØŸ')) {
                portfolio.holdings = [];
                localStorage.setItem('portfolio', JSON.stringify(portfolio));
                showPortfolio();
            }
        }

        // Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†
        function showProfit() {
            const goldProfit = calculateProfit('gold');
            const silverProfit = calculateProfit('silver');
            
            document.getElementById('profitGold').innerHTML = goldProfit || '<p>ğŸ… Ø·Ù„Ø§ÛŒÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>';
            document.getElementById('profitSilver').innerHTML = silverProfit || '<p>ğŸ¥ˆ Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>';
            document.getElementById('profitModal').style.display = 'flex';
        }

        function calculateProfit(metal) {
            const holdings = portfolio.holdings.filter(h => h.metal === metal);
            if (holdings.length === 0) return null;
            
            const totalAmount = holdings.reduce((s, h) => s + h.amount, 0);
            const totalCost = holdings.reduce((s, h) => s + (h.amount * h.price), 0);
            const avgPrice = totalCost / totalAmount;
            const currentPrice = metal === 'gold' ? mockPrices.gold : mockPrices.silver;
            
            const currentValue = totalAmount * currentPrice;
            const commission = currentValue * 0.01;
            const netValue = currentValue - commission;
            const profit = netValue - totalCost;
            const percent = (profit / totalCost) * 100;
            
            return `
                <div style="margin-bottom:10px">
                    <b>${metal === 'gold' ? 'ğŸ… Ø·Ù„Ø§' : 'ğŸ¥ˆ Ù†Ù‚Ø±Ù‡'}</b><br>
                    Ù…Ù‚Ø¯Ø§Ø±: ${totalAmount.toFixed(2)} Ú¯Ø±Ù…<br>
                    Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø®Ø±ÛŒØ¯: ${avgPrice.toLocaleString()}<br>
                    Ø§Ø±Ø²Ø´ ÙØ¹Ù„ÛŒ: ${netValue.toLocaleString()}<br>
                    <span style="color:${profit >= 0 ? 'green' : 'red'}">
                        ${profit >= 0 ? 'ğŸŸ¢ Ø³ÙˆØ¯' : 'ğŸ”´ Ø²ÛŒØ§Ù†'}: ${Math.abs(profit).toLocaleString()} (${percent.toFixed(2)}%)
                    </span>
                </div>
            `;
        }

        // Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
        function showAlerts() {
            document.getElementById('goldMin').value = alerts.gold.min;
            document.getElementById('goldMax').value = alerts.gold.max;
            document.getElementById('goldEnabled').checked = alerts.gold.enabled;
            document.getElementById('silverMin').value = alerts.silver.min;
            document.getElementById('silverMax').value = alerts.silver.max;
            document.getElementById('silverEnabled').checked = alerts.silver.enabled;
            document.getElementById('alertsModal').style.display = 'flex';
        }

        function saveAlerts() {
            alerts.gold = {
                min: parseInt(document.getElementById('goldMin').value),
                max: parseInt(document.getElementById('goldMax').value),
                enabled: document.getElementById('goldEnabled').checked
            };
            alerts.silver = {
                min: parseInt(document.getElementById('silverMin').value),
                max: parseInt(document.getElementById('silverMax').value),
                enabled: document.getElementById('silverEnabled').checked
            };
            localStorage.setItem('alerts', JSON.stringify(alerts));
            closeModal('alertsModal');
            showToast('âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }

        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        function showSettings() {
            document.getElementById('reportInterval').value = settings.reportInterval;
            document.getElementById('reportType').value = settings.reportType;
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function saveSettings() {
            settings.reportInterval = parseInt(document.getElementById('reportInterval').value);
            settings.reportType = document.getElementById('reportType').value;
            localStorage.setItem('settings', JSON.stringify(settings));
            closeModal('settingsModal');
            
            if (window.updateInterval) clearInterval(window.updateInterval);
            window.updateInterval = setInterval(simulatePriceChange, settings.reportInterval * 60 * 1000);
            showToast('âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }

        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) e.target.style.display = 'none';
        };

        // Ø´Ø±ÙˆØ¹
        updateDisplay();
        window.updateInterval = setInterval(simulatePriceChange, settings.reportInterval * 60 * 1000);

        tg.MainButton.setText("ğŸ“Š Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ");
        tg.MainButton.onClick(simulatePriceChange);
        tg.MainButton.show();

        showToast('Ø¨Ù‡ metals_dashboard Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯');
    </script>
</body>
</html>
